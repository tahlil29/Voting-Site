{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">ðŸ‘¥ Manage Users</h4>
    <span class="badge bg-info">Total Users: {{ users|length }}</span>
</div>

<div class="table-responsive">
<table class="table table-bordered table-hover align-middle">
    <thead class="table-dark text-center">
        <tr>
            <th>Email</th>
            <th>Role</th>
            <th style="width: 260px;">Actions</th>
        </tr>
    </thead>

    <tbody>
        <input type="text" id="userSearch"
            class="form-control mb-3"
               placeholder="ðŸ” Search users by email or role">
        {% for u in users %}
        <tr>
            <td class="fw-semibold text-dark">
                 {{ u.username }}
            </td>

            <td class="text-center">
                {% if u.role == 'admin' %}
                    <span class="badge bg-danger">ADMIN</span>
                {% else %}
                    <span class="badge bg-secondary">USER</span>
                {% endif %}
            </td>
            
            <td class="text-center">
                <div class="d-flex flex-wrap justify-content-center gap-2">

                    {# ðŸ”’ Prevent admin from modifying himself #}
                    {% if u.id == session.get('user_id') %}
                        <span class="text-muted small">You</span>

                    {% else %}

                        {% if u.role == 'user' %}
                        <a class="btn btn-sm btn-success"
                           href="{{ url_for('toggle_user', user_id=u.id, action='promote') }}">
                           â¬† Promote
                        </a>
                        {% else %}
                        <a class="btn btn-sm btn-warning"
                           href="{{ url_for('toggle_user', user_id=u.id, action='demote') }}">
                           â¬‡ Demote
                        </a>
                        {% endif %}

                        <a class="btn btn-sm btn-danger"
                           href="{{ url_for('toggle_user', user_id=u.id, action='delete') }}"
                           onclick="return confirm('Are you sure you want to delete this user?');">
                           ðŸ—‘ Delete
                        </a>

                    {% endif %}
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

{% endblock %}
